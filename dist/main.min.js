/*! twtestapp - v0.0.0 - 2012-11-08
* Copyright (c) 2012 Satoshi Ohki; Licensed  */
(function(a,b){"use strict",a.App={DEFAULT_KEYWORD:"@iphone_dev_jp"}})(this),function(a,b){"use strict",typeof Object.create!="function"&&(Object.create=function(a){var b=function(){};return b.prototype=a,new b})}(),function(a,b,c){"use strict",a.App.functions=function(){var a={isDefinedOrNotNull:function(a){return typeof a!="undefined"||a!==null},compact:function(a){var c=b.isArray(a)?a:[a];return b.grep(c,function(a,b){return!!a})}};return a}()}(this,jQuery),function(a,b,c){"use strict",a.App.Iterator=function(){function a(a){this.tokens=a||[],this.length=this.tokens.length}return a.prototype={hasNext:function(){return this.length>0?!0:!1},next:function(){var a=this.tokens.shift();return this.length=this.tokens.length,a}},a}()}(this,jQuery),function(a,b,c){"use strict",a.App.viewHelpers=function(){var a={loadingView:['<div class="loading bar">',"<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","<div></div>","</div>"].join(""),tweetView:function(a,b,c){return['<div class="tw-content">','<img class="avatar" src="'+a+'" />','<p class="user">'+b+"</p>",'<p class="text">'+c+"</p>","</div>"].join("")},createAnchor:function(a,b){return['<a href="',encodeURI(a),'" target="_blank">',b?b:a,"</a>"].join("")}};return a}()}(this,jQuery),function(a,b,c){"use strict";var d=a.App,e=d.functions;d.Tweet=function(){function f(a){this._updateAttributes(a),this.idAttribute="from_user_id",this.set(this._attributes),this.tokenBuffer=[]}var a={user:/(^|\W)?(@\w+)(\W|$)?/g,hash:/(^|\W)?(#\w+)(\W|$)?/g,url:/((?:http|https):\/\/[\S]+)/g},c={user:/^@/,hash:/^#/,url:/^(?:http|https):\/\//},d={user:"createUserUrl",hash:"createHashUrl",url:"createUrl"};return f.prototype={homepageUrl:"https://twitter.com/",getPattern:function(b){return b?a[b]:a},createUrl:function(a,b){return a},createUserUrl:function(a,b){var d=c[b],e=a?a:this.get("from_user");return this.homepageUrl+(d?e.replace(d,""):e)},createHashUrl:function(a,b){var d=c[b],e="https://twitter.com/search?q=%23%(text)s&src=hash";return e.replace("%(text)s",a.replace(d,""))},parseLink:function(a,e,f){var g=c[e];if(a.match(g)){var h=d[e],i=h?b.proxy(this[h],this):null;if(typeof i=="function"){var j=i(a,e);if(typeof f=="function")return f(j,a)}}return a},parseText:function(b,c){return e.compact(b.split(a[c]))},_updateAttributes:function(a){return this._attributes=b.extend({},b.isPlainObject(a)?a:{}),this},get:function(a){return this._attributes[a]},set:function(a,c){var d,e;typeof a=="object"&&!b.isArray(a)||!a?d=a:(d={},d[a]=c);if(!d)return this;b.isPlainObject(d)||(d=d._attributes),this.idAttribute in d&&(this.id=d[this.idAttribute]);var f=this._attributes;for(var g in d)e=d[g],f[g]=e},getAttributes:function(){return this._attributes}},f}()}(this,jQuery),function(a,b,c){"use strict",a.App.Tweets=function(){function c(a){this.models=[],this._updateAttributes(a)}return c.prototype={model:a.App.Tweet,_updateAttributes:function(a){return this._attributes=b.extend({},b.isPlainObject(a)?a:{}),this},count:function(){return this.length=this._attributes.results.length,this._attributes.results.length},isEmpty:function(){return this.count()===0?!0:!1},getResponse:function(a){return this._attributes[a]},get:function(a){return this._byId[a]},add:function(a){var b=this.models.length;for(var c=0,d=a.length;c<d;c++){var e=this._prepareModel(a[c]);this.models[b]=this._prepareModel(a[c]),e.id&&(this._byId[e.id]=e),b+=1}return this},reset:function(a){for(var b=0,c=this.models.length;b<c;b++)this._prepareModel(this.models[b]);return this._reset(),this._updateAttributes(a),this.add(a.results),this},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,c){var d=c||{};if(b.isPlainObject(a)){var e=a;d.collection=this,a=new this.model(e,d)}return a},_removeReference:function(a){this===a.collection&&delete a.collection},search:function(a){var c=this,d=b.Deferred(),e="http://search.twitter.com/search.json",f=b.ajax({type:"GET",timeout:1e4,url:e,data:b.param({q:a}),dataType:"jsonp"}).done(function(a,b,e){d.resolve(c.reset(a),b,e)}).fail(function(a,b,e){d.reject(c.reset(),b,a,e)});return d.promise()}},c.create=function(a){return new this(a)},c}()}(this,jQuery),function(a,b,c){"use strict";var d=a.App,e=d.functions;d.View=function(){function c(){return a?a:(a=this,this)}var a=null;return c.prototype={initialize:function(a){var b=a||{};this.collection=b.collection},registerEvents:function(){return b(document).on("submit","form",b.proxy(this.onSubmit,this)),this},onSubmit:function(a){var c=a.currentTarget,d=b(".tw-search"),f=d.val();d.blur(),e.isDefinedOrNotNull(f)&&this.search(f)},showLoading:function(){b("#tweets").html(this.loadingView)},hideLoading:function(){b("#tweets").empty()},search:function(a){var c=this;this.showLoading(),this.collection.search(a).done(b.proxy(this.onSuccessSearch,this)).fail(b.proxy(this.onFailSearch,this))},onSuccessSearch:function(a,b){this.hideLoading(),this.updateTweets(a)},onFailSearch:function(a){console.error(a),this.hideLoading(),b("#tweets").text("Error Loading Tweets")},updateTweets:function(a){a.isEmpty()?b("#tweets").text("Tweets are nothing"):this.updateList(a.models)},updateList:function(a){var c=this,d=b("#tweets");b.each(a,function(a,b){d.append(c.createTweetList(b))})},createTweetList:function(a){var c=a.createUserUrl(),d=this.createAnchor(c,a.get("from_user")),e=a.get("text")||"",f=b.Deferred();return f.pipe(b.proxy(this.parseLinkInText,this)).pipe(b.proxy(this.parseLinkInText,this)).pipe(b.proxy(this.parseLinkInText,this)).pipe(function(a,b){e=b}),f.resolve(a,e,["url","user","hash"]),this.tweetView(a.get("profile_image_url"),d,e)},parseLinkInText:function(a,c,e){var f=b.Deferred(),g=e.shift(),h=[],i=new d.Iterator(a.parseText(c,g));while(i.hasNext()){var j=this,k=i.next();h.push(a.parseLink(k,g,function(a,b){return j.createAnchor(a,b)}))}return f.resolve(a,h.join(""),e)}},c.getInstance=function(){return a||new c},c}()}(this,jQuery),function(a,b,c){"use strict";var d=a.App;b.extend(d.View.prototype,d.viewHelpers),b(function(){var a=d.View.getInstance();a.initialize({collection:new d.Tweets}),a.registerEvents().search(d.DEFAULT_KEYWORD)})}(this,jQuery);
